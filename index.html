<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Geoportal — Mapas históricos</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html,body{height:100%;margin:0}
    body{font-family:system-ui,Segoe UI,Roboto,Arial}
    #top{
      display:flex;
      gap:.5rem;
      align-items:flex-start;
      padding:.5rem .75rem;
      background:#111827;
      color:#e5e7eb;
    }
    #map{height:calc(100% - 70px)}
    .card{
      background:#0f172a;
      color:#e5e7eb;
      border-radius:10px;
      padding:.4rem .6rem;
      display:flex;
      flex-direction:column;
      gap:.35rem;
      font-size:.9rem;
    }
    .card-header{font-weight:600;margin-bottom:.15rem}
    .overlay-row{
      display:flex;
      align-items:center;
      gap:.35rem;
      margin-bottom:.25rem;
      font-size:.8rem;
    }
    .overlay-row label{
      display:flex;
      align-items:center;
      gap:.25rem;
      min-width:150px;
    }
    input[type=range]{width:120px}
    select,button{
      background:#111827;
      color:#e5e7eb;
      border:1px solid #1f2937;
      border-radius:10px;
      padding:.3rem .6rem;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div id="top">
    <strong style="margin-right:.5rem;margin-top:.3rem;">
      Geoportal — Mapas históricos
    </strong>

    <!-- BASES -->
    <div class="card">
      <div class="card-header">Mapas base</div>
      <select id="base">
        <option value="osm">OSM</option>
        <option value="opentopo">OpenTopo</option>
        <option value="esri">Esri Imagery</option>
      </select>
    </div>

    <!-- OVERLAYS HISTÓRICOS -->
    <div class="card">
      <div class="card-header">Mapas históricos (XY tiles)</div>
      <div id="overlays"></div>
    </div>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map("map", { center:[17.046,-96.635], zoom:14 });

    // --- MAPAS BASE ---
    const base = {
      osm: L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {maxZoom:20,attribution:"© OpenStreetMap"}
      ),
      opentopo: L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",
        {maxZoom:18,attribution:"© OpenTopoMap, © OSM"}
      ),
      esri: L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {maxZoom:20,attribution:"© Esri, Maxar"}
      )
    };
    base.osm.addTo(map);

    document.getElementById("base").addEventListener("change", e=>{
      Object.values(base).forEach(l=>map.removeLayer(l));
      base[e.target.value].addTo(map);
    });

    // --- TUS 2 MAPAS HISTÓRICOS ---
    const overlayConfigs = [
      {
        id: "aranjuez",
        nombre: "Plano H_Aranjuez",
        url: "./tiles_aranjuez/{z}/{x}/{y}.png",
        tms: false,
        opacidadInicial: 0.6,
        atrib: "Plano histórico Aranjuez (fuente/año)"
      },
      {
        id: "cincosenores",
        nombre: "Plano H_CincoSeñores",
        url: "./tiles_cincosenores/{z}/{x}/{y}.png",
        tms: false,
        opacidadInicial: 0.6,
        atrib: "Plano histórico Cinco Señores (fuente/año)"
      }
    ];

    const overlayLayers = {};
    const overlaysDiv = document.getElementById("overlays");

    overlayConfigs.forEach(cfg => {
      const layer = L.tileLayer(cfg.url,{
        opacity: cfg.opacidadInicial,
        maxZoom:22,
        tms: cfg.tms,
        attribution: cfg.atrib
      });
      overlayLayers[cfg.id] = layer;

      // Activamos por defecto
      layer.addTo(map);

      const row = document.createElement("div");
      row.className = "overlay-row";
      row.innerHTML = `
        <label>
          <input type="checkbox" data-id="${cfg.id}" checked>
          ${cfg.nombre}
        </label>
        <input type="range"
               min="0" max="1" step="0.05"
               value="${cfg.opacidadInicial}"
               data-id="${cfg.id}">
      `;
      overlaysDiv.appendChild(row);

      const chk = row.querySelector('input[type="checkbox"]');
      const rng = row.querySelector('input[type="range"]');

      chk.addEventListener("change", e => {
        const id = e.target.dataset.id;
        const lyr = overlayLayers[id];
        if(e.target.checked){
          lyr.addTo(map);
        } else {
          map.removeLayer(lyr);
        }
      });

      rng.addEventListener("input", e => {
        const id = e.target.dataset.id;
        const lyr = overlayLayers[id];
        lyr.setOpacity(parseFloat(e.target.value));
      });
    });
  </script>
</body>
</html>
