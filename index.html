<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visor Geohistórico Interactivo (VGI)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body{
      height:100%;
      margin:0;
    }
    body{
      display:flex;
      flex-direction:column;
      font-family:system-ui,Segoe UI,Roboto,Arial;
      background:#704214;
      color:#f5f5f4;
    }

    /* Barra superior */
    #top{
      display:flex;
      gap:1rem;
      align-items:flex-start;
      padding:.7rem .9rem;
      background:#4f2d10;
      box-shadow:0 2px 6px rgba(0,0,0,.35);
      z-index:1000;
      flex-wrap:wrap;
    }

    .app-title{
      font-weight:700;
      font-size:1.15rem;
      letter-spacing:.05em;
      text-transform:uppercase;
      text-shadow:0 1px 2px rgba(0,0,0,.4);
      line-height:1.2;
    }

    .subtitle{
      font-size:.82rem;
      margin-top:.15rem;
      opacity:0.9;
      max-width:300px;
      line-height:1.1;
    }

    .card{
      background:#5c3413;
      color:#f5f5f4;
      border-radius:12px;
      padding:.5rem .7rem;
      display:flex;
      flex-direction:column;
      gap:.35rem;
      font-size:.9rem;
      border:1px solid #8c5930;
    }
    .card-header{
      font-weight:600;
      margin-bottom:.15rem;
      font-size:.9rem;
    }

    select{
      background:#704214;
      color:#f5f5f4;
      border:1px solid #8c5930;
      border-radius:999px;
      padding:.3rem .7rem;
      cursor:pointer;
      font-size:.85rem;
    }

    #map-container{
      position:relative;
      flex:1;
    }
    #map{
      position:absolute;
      inset:0;
    }

    /* Panel lateral histórico */
    #overlay-panel{
      position:absolute;
      top:1rem;
      right:1rem;
      z-index:1200;
      width:300px;
    }

    .overlay-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:.4rem;
      font-size:.8rem;
      width:100%;
    }

    .overlay-row label{
      display:flex;
      align-items:center;
      gap:.25rem;
      flex:1;
    }

    input[type=range]{
      width:120px;
      margin-left:.3rem;
    }

    /* Footer */
    #footer{
      background:#4f2d10;
      color:#f5f5f4;
      font-size:.78rem;
      text-align:center;
      padding:.25rem .5rem;
      border-top:1px solid #8c5930;
    }
  </style>
</head>
<body>

  <div id="top">
    <div>
      <div class="app-title">Visor Geohistórico Interactivo (VGI)</div>
      <div class="subtitle">Recuperación de los territorios, haciendas y pueblos de los siglos XIX–XX</div>
    </div>

    <!-- MAPAS BASE -->
    <div class="card">
      <div class="card-header">Mapas base</div>
      <select id="base">
        <option value="osm">OSM</option>
        <option value="opentopo" selected>OpenTopo</option>
        <option value="esri">Esri Imagery</option>
      </select>
    </div>
  </div>

  <div id="map-container">
    <div id="map"></div>

    <!-- PANEL LATERAL -->
    <div id="overlay-panel" class="card">
      <div class="card-header">Mapas históricos (XY tiles)</div>
      <div id="overlays"></div>
    </div>
  </div>

  <div id="footer">
    Construido por: Antonio Escobar Ohmstede, Daniela Osorio Crespo y Carlos Alfredo Hernández Guillén
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const map = L.map("map", { center:[17.046,-96.635], zoom:14 });

    /* MAPAS BASE */
    const base = {
      osm: L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {maxZoom:20, attribution:"© OpenStreetMap"}),
      opentopo: L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",
        {maxZoom:18, attribution:"© OpenTopoMap"}),
      esri: L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {maxZoom:20, attribution:"© Esri, Maxar"})
    };

    // Base inicial: OpenTopo
    base.opentopo.addTo(map);

    document.getElementById("base").addEventListener("change", e=>{
      Object.values(base).forEach(l=>map.removeLayer(l));
      base[e.target.value].addTo(map);
    });

    /* MAPAS HISTÓRICOS */
    const overlayConfigs = [
      { id:"aranjuez", nombre:"Hacienda Aranjuez",     url:"./tiles_aranjuez/{z}/{x}/{y}.png",    opacidadInicial:0.6 },
      { id:"cincosenores", nombre:"Hacienda Cinco Señores", url:"./tiles_cincosenores/{z}/{x}/{y}.png", opacidadInicial:0.6 },
      { id:"del_carmen", nombre:"Hacienda del Carmen", url:"./tiles_del_carmen/{z}/{x}/{y}.png", opacidadInicial:0.6 },
      { id:"montoya", nombre:"Hacienda Montoya",       url:"./tiles_montoya/{z}/{x}/{y}.png",    opacidadInicial:0.6 },
      { id:"rosario", nombre:"Hacienda del Rosario",   url:"./tiles_rosario/{z}/{x}/{y}.png",    opacidadInicial:0.6 }
    ];

    const overlayLayers = {};
    const overlaysDiv = document.getElementById("overlays");

    overlayConfigs.forEach(cfg => {
      const layer = L.tileLayer(cfg.url, {
        opacity: cfg.opacidadInicial,
        maxZoom:22
      });
      // NO se agrega al mapa por defecto
      overlayLayers[cfg.id] = layer;

      const row = document.createElement("div");
      row.className = "overlay-row";

      row.innerHTML = `
        <label>
          <input type="checkbox" data-id="${cfg.id}">
          ${cfg.nombre}
        </label>
        <input type="range" min="0" max="1" step="0.05"
               value="${cfg.opacidadInicial}" data-id="${cfg.id}">
      `;

      overlaysDiv.appendChild(row);

      const chk = row.querySelector('input[type="checkbox"]');
      const rng = row.querySelector('input[type="range"]');

      chk.addEventListener("change", e => {
        const lyr = overlayLayers[e.target.dataset.id];
        if (e.target.checked){
          lyr.addTo(map);
        } else {
          map.removeLayer(lyr);
        }
      });

      rng.addEventListener("input", e => {
        overlayLayers[e.target.dataset.id].setOpacity(parseFloat(e.target.value));
      });
    });
  </script>
</body>
</html>
